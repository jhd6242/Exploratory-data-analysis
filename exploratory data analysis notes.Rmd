---
title: "Exploratory Data Analysis"
author: "Justin DeCross"
date: "September 24, 2018"
output: html_document
---
# Getting and Cleaning Data Notes
## Week 1
###Principles of Analytic Graphics
#### Principles of Analytic Graphic
 * Principal 1: Show Comparisons
      + Evidence for a Hypothesis is always relative to another competing hypothesis.
      + Always ask "Compared to What?"
 * Principal 2: Show causality,  mechanism,  explanation, systematic structure
      + What is your casual framework for thinking about a question?
 * Principal 3: Show multivariate data
      + Multivariate=more than 2 variables
      + The real world is multivariate
      + Need to "escape flatland"
 * Principal 4: Integration of evidence
      + Completely integrate word, numbers, images, diagrams
      + Data graphics should make use of many mode of data presentation
      + Don't let the tool drive the analysis
 * Principal 5: Describe and document the evidence with appropriate labels, scales, sources, etc.
      + A data graphic should tell a complete story that is credible
 * Principal 6: Content is king
      + Analytical presentations ultimately stand or fall depending on the quality, relevance, and integrity of their content

#### Show Comparisons
 * box graph
 * show causality, mechanism
 
#### Show multivariate data
 * Daily mortality rate Verse particulate matter
 * 4 different graphs comparing the different seasons  when it comes to particulate matter versus mortality rate
 
#### Integrate different modes of evidence
 * example of clean plots
 
#### Summary
 * Principal 1: Show comparisons
 * Principal 2: Show causality, mechanism, explanation
 * Principal 3: Show multivariate data
 * Principal 4: Integrate multiple modes of evidence
 * Principal 5: Describe and document the evidence
 * Principal 6: Content
 
### Exploratory Graphs (part 1)
#### Exploratory graphs
#### Why do we use graphs in data analysis?
 * To understand data properties
 * To find patterns in data
 * To suggest modeling strategies
 * To"debug" analyses
 * To communicate results
 
#### Characteristics of exploratory graphs
 * They are made quickly
 * A large number are made
 * The goal is for personal understanding
 * Axes/legends are generally cleaned up(later)
 * Color/size are primarily used for information

#### Air Pollution in the United States
 * The US Environmental Protection Agency(EPA) Sets national ambient air quality standards for outdoor air pollution.
 * Question: Are there any counties in the US that exceed the national standard for fine particle pollution?
 
#### Data
 * Can't find data set for example
 
#### Simple Summaries of Data
 * One dimension
    + 5-number summary
    + Boxplots
    + Histograms
    + Density plot
    + Barplot
    
#### 5-number Summary
#### Boxplot
#### Histogram
 * rug function
 
#### Overlaying Features
 * overlaying a horizontal line over the box plot
 * overlaying a vertical line over the histogram
 
#### Barplot
 * Summarizes a categorical variable

### Exploratory Graphs(part 2)

#### Simple Summaries of Data

 * 2 dimensions
    + Multiple/overlaid 1D plots(Lattice/ggplot2)
    + Scatterplots
    + Smooth scatterplots
 * 2 dimensions
    + overlaid/multiple 2D Plots; co-plots
    + Use color, size, shape to add dimensions
    + Spinning plots
    + Actual 3D plot(not that useful)
    
#### Multiple Boxplots  

#### Multiple Histograms

#### Scatterplot
 * abline() does a overlay
 * use color
 * Use multiple scatterplot to display  East and West variables
 
#### Summary
 * Exploratory plots are "quick and dirty"
 * Let you summarize the data(usually graphically) and highlight any broad features
 * Explore basic questions and hypotheses(and perhaps rule them out)
 * Suggest modeling strategies for the"next step"
 
### Plotting Systems in R

#### The Base Plotting System
 * "Artist's palette" model
 * Start with blank canvas and build up from there
 * Start with plot function(or similar)
 * Use annotation functions to add/modify( text, lines, points, axis)
 * Convenient, mirrors how we think of building plots and analyzing data
 * Can't go back once plot has started(i.e. to adjust margins); need to plan in advance
 * Difficult to"translate" to others once a new plot has been created(no graphical "language")
 * Plot is this a series of R commands
 
#### Base Plot

```{r}
library(datasets)
data(cars)
with(cars, plot(speed, dist))
```
 

#### The Lattice System
 * Plots are created with a single function call(xyplot, bwplot, etc.)
 * Most useful for conditioning types of plots: Looking at how y changes with x across levels of z
 * Things like margins/spacing set automatically because entire plot is specified at once
 * Good for putting many many plots on a screen
 * Sometimes awkward to specify and the entire plot in a single function call
 * Annotation in plot is not especially intuitive
 * Use of panel functions and subscripts difficult to wield and requires intense preparation
 * Cannot "add" to the plot once it is created
 
#### Lattice Plot

```{r}
library(lattice)
state <- data.frame(state.x77, region = state.region)
xyplot(Life.Exp~Income |  region, data = state, layout = c(4, 1))

```
 
#### The ggplot2 System
 * Splits the difference between base and lattice in a number of ways
 * Automatically deals with spacings, text, titles but also allows you to annotate by"adding to a plot"
 * Superficial similarity to lattice but generally easier/more intuitive to use
 * Default  mode makes many choices for you (but you can still customize to your hearts desire)
 
#### ggplot2 Plot

```{r}
library(ggplot2)
data(mpg)
qplot(displ, hwy, data = mpg)
```

#### Summary
 * Base:"artist's palette" model
 * Lattice: Entire plot specified by one function; conditioning
 * ggplot2: Mixes elements of Base and Lattice
 
### Base Plotting System(part 1)
#### Plotting System
 * The core plotting and graphics engine in R is encapsulated in the following packages:
    + graphics: contains plotting functions for the"base" graphing systems, including plot, hist, box  plot and many others.
    + grDevices: Contains all the code implementing the various graphics devices, including X11, PDF,  PostScript, PNG, etc.
 * The lattice plotting system is implemented using the following  packages:
    + lattice: contains code for producing Trellis graphics, which are independent of the"base" graphics system; includes functions like xyplot, bwplot, levelplot
    + grid: implements a different graphing system independent of the"base" system;; the lattice package builds on top of the grid; we seldom call functions from the grid package directly
    
#### The Process of Making a Plot
When making a plot one must 1st make a few considerations(not necessarily in this order):

 * Where will the plot be made? On the screen? Can a file?
 * How will the plot be used?
    + Is the plot for viewing temporarily on the screen?
    + Will it be presented in a web browser?
    + Will it eventually end up in a paper that might be printed?
    + Are you using it in a presentation?
 * Is there a large amount of data going into the plot? Or is it just a few points?
 * Do you need to be able to dynamically resize a graphic?
 
#### The Process of Making a Plot
 * What graphics system will you use: base, lattice, or ggplot2? These generally cannot be mixed.
 * Base graphics are usually constructed piece mail, with each aspect of the plot handled separately through a series of function calls; this is often conceptually simpler and allows plotting to mirror  the thought process
 * Lattice graphics are usually created in a single function call, so all the graphics parameters have to be specified at once; specifying everything out once allows R to automatically calculate the necessary spacings and font sizes.
 * ggplot2 combines concepts from both base and lattice graphics but uses it independent implementation
 
We focus on using the base plotting system to create graphics on the screen device.

#### Base Graphics
Base graphics are used most commonly and are very powerful system for creating 2D graphics.

 * There are 2 phases to creating a base plot
    + Initializing a new plot
    + Annotating(adding to) an existing plot
 * Calling plot(x, y) or hist(x) will launch a graphics device(if one is not already open) and draw a new plot On the device
 * If the arguments to plot are not the same special class, then the default method for plot is called; this function has many arguments, letting you set the title, X Axis label, Y Axis label, etc.
 * The base graphics system has many parameters that can be set and tweaked; these parameters are documented in ?par; it wouldn't hurt to try to memorize this help page!
 
#### Simple Base Graphics: Histogram

```{r}
library(datasets)
hist(airquality$Ozone)
```
 


#### Simple Base Graphics: Scatterplot

```{r}
library(datasets)
with(airquality, plot(Wind, Ozone))
```
    
#### Simple Base Graphics: Boxplot

```{r}
library(datasets)
airquality <- transform(airquality, Month  = factor(Month))
boxplot(Ozone~Month, airquality, xlab = "Month", ylab = "Ozone (ppb)")


```


#### Important Base Graphics Parameters

Many days plotting function share a set of parameters. Here are a few key ones:

 * pch: the plotting symbol(default is  open circle)
 * lty: the line type(default is solid line),can be dashed, dotted, etc.
 * lwd: the line width, specified as integer multiple
 * col: the plotting color, specified as a number, string, or hex code; the colors() function gives you a vector of  colors by name
 * xlab: character string for the X axis label
 * ylab: character string for the y axis label
 
#### Some Important Base Graphics Parameters

The par() function is used to specify global  graphics parameters that affect all plots in an R session. These parameters can be overridden when specified as arguments  to specific plotting functions.
 * las: the orientation of the axis labels on the plot
 * bg: the background color
 * mar: the margin size
 * oma: the outer margin size( default is 0 for all sides)
 * mfrow: number of plots per row, column(plots are filled row--wise)
 * mfcol; number of plots per row, column( plots are filled column-wise)
 
#### Some Important  Base Graphics Parameters

Default values for global graphics parameters

```{r}
par("lty")

par("col")

par("pch")

par("bg")

par("mar")

par("mfrow")
```


### Base Plotting System(part 2)

#### Base Plotting Functions

 * plot: make a scatterplot, or other type of plot depending on the class  of the object being plotted
 * lines: add lines to their plot, given a vector x values and a corresponding vector of y values (or a 2-column matrix); this function just connects the dots
 * points: add points to a plot
 * text: add text labels to a plot using specified x, y coordinates
 * title: Add annotations to x,y axis labels, title, subtitle, outer margin
 * mtext: add arbitrary tax to the margins (inner or outer) of the plot
 * axis: adding axis ticks/labels

#### Base Plot with Annotation

```{r}
library(datasets)
with(airquality, plot(Wind, Ozone))
title(main = "Ozone and Wind in New York City") # Add a title
```


```{r}
with(airquality, plot(Wind, Ozone, main = "Ozone and Wind in New York City"))
with(subset(airquality, Month == 5), points(Wind, Ozone, col = "blue"))

```


```{r}
with(airquality, plot(Wind, Ozone, main = "Ozone and Wind in New York City", type = "n"))
with(subset(airquality, Month == 5), points(Wind, Ozone, col = "blue"))
with(subset(airquality, Month!= 5), points(Wind, Ozone, col = "red"))
legend("topright", pch = 1, col = c("blue","red"), legend = c("May","Other Months"))
```


#### Base Plot with Regression Line

```{r}
with(airquality, plot(Wind, Ozone, main = "Ozone and Wind in New York City", pch = 20))
model <- lm(Ozone ~ Wind, airquality)
abline(model, lwd = 2)
```


#### Multiple Base Plots

```{r}
par(mfrow = c(1, 2))
with(airquality, {
	plot(Wind, Ozone, main = "Ozone and Wind")
	plot(Solar.R, Ozone, main = "Ozone and Solar Radiation")
})
```

```{r}
par(mfrow = c(1, 3), mar = c(4, 4, 2, 1), oma = c(0, 0, 2, 0))
with(airquality, {
	plot(Wind, Ozone, main = "Ozone and Wind")
	plot(Solar.R, Ozone, main = "Ozone and Solar Radiation")
	plot(Temp, Ozone, main = "Ozone and Temperature")
	mtext("Ozone and Weather in New York City", outer = TRUE)
})
```

#### Summary

 * Plots in the base plotting system are created by calling successive R functions to"build up" a plot
 * Plotting occurs in 2 stages:
      + Creation of a plot
      + Annotation of a plot (adding lines, points, text, legend)
 * The base plotting system is very flexible and offers a high degree of control over plotting
 
### Base Plotting Demonstration

### Graphics Devices in R

#### What is a Graphics Device?

 * A graphics device is something where you can make a plot appear
      + A window on your computer(screen device)
      + A PDF file(file device)
      + A PNG or JPEG file(file device)
      + A scalable Vector graphics(SVG) file(file device)
 * When you make a plot in R it has to be "sent" to a specific graphics device
 * The most common place for a pot to be "sent" is the screen device
      + On a Mac the screen device is launched with the quartz()
      + On Windows the screen device is launched with windows()
      + On UNIX/Linux screen device is launched with x11()
      
#### What is a Graphic Device?

 * When making a plot, you need to consider how the plot will be used to determine what device the plot should be sent to.
      + The list of devices is found in ?Devices; there are also devices created by users on CRAN
 * For quick visualization and exploratory analysis, usually you want to see the screen device
      + Functions like plot in base, xyplot in lattice, or qplot in ggplot2 will default to sending a plot to the screen
      + For a given platform(Mac, Windows, UNIX/Linux) there is only one screen device
 * For plots that may be printed out to be incorporated into a document(e.g. papers/reports, slide presentations), usually a file device is more appropriate
      + There are many different file devices to choose from
 * NOTE: not all graphics devices are available on all platforms(i.e. you cannot launch the windows() on a Mac)

#### How Does a Plot Get Created?

There are two basic approaches to plotting. The 1st is most common:

 * Call a plotting function like plot, xyplot, or qplot
 * The plot appears on the screen device
 * Annotate plot if necessary
 * Enjoy

```{r}
library(datasets)
with(faithful, plot(eruptions, waiting))	# Make plot appear on screen device
title(main = "Old Faithful Geyser data")	# Annotate with a title

```

#### How Does a Plot Get Created?

The 2nd approach to plotting and most commonly used for file devices:

 * Explicitly launch a graphic device
 * Call a plotting function to make a plot(Note: if you are using a file device, no plot will appear on the screen)
 * Annotate plot if necessary
 * explicitly close graphics device with dev.off()(this is very important!)

```{r}
library(datasets)
pdf(file = "myplot.pdf")	# Open PDF device; create 'myplot.pdf' in my working directory
# Create plot and then to a file(no plot appears on screen)
with(faithful, plot(eruptions, waiting))
title(main = "Old Faithful Geyser data")	# Annotate plot; still nothing on screen
dev.off()	# Close the PDF file device
# Now you can view the file 'myplot.pdf' on your computer
```


### Graphics Devices in R(part 2)

#### Graphics File Devices

There are 2 basic types of file devices: vector and bitmap devices

Vector formats:

 * pdf: useful for line-type graphics, resizes well, usually portable, not efficient if a plot has many objects/points
 * svg: XML-based scalable Vector graphics: supports animation and interactivity, potentially useful for web-based plot
 * win.metafile: Windows metafile format(only on Windows)
 * postscript: older format, also resizes well, usually portable, can be used to create encapsulated postscript files; Windows systems often don't have a postscript viewer
 
 
#### Graphics File Devices

Bitmap formats

 * png: bitmapped format, good for line drawings or images with solid colors, uses lossless compression(like the old GIF format), most web browsers can read this format natively, good for plotting many many many points, does not resize well
 * jpeg: good for photographs or natural scenes, uses lossy compression, good for plotting many many many points, does not resize well, can be read by almost any computer and any web browser, not great for line drawings
 * tiff: Creates bitmap files in the TIFF format; supports lossless compression
 * bmp: a native Windows bitmapped format


#### Multiple Open Graphics Devices

 * It is possible to open multiple graphics devices(screen, file, or both), for example when viewing multiple plots at once
 * Plotting can only occur on one graphics device at a time
 * The currently active graphics device can be found by calling dev.cur()
 * Every open graphics device designed an integer greater than or equal to 2
 * You can change the active graphics device with dev.set(<integer>) where <integer> is the number associated with the graphics device you want to switch to

#### Copying Plots

Copying a plot to another device can be useful because some plots require a lot of code and they can be a pain to type all that in again for a different device.

 * dev.copy: copy a plot from one device to another
 * dev.copy2pdf: specifically copy a plot to a PDF file
NOTE: Copying a plot is not an exact operation, so the results may not be identical to the original.

```{r}
library(datasets)
with(faithful, plot(eruptions, waiting))	# Create plot on a screen device
title(main = "Old Faithful Geyser data")	# Add a main title
dev.copy(png, file = "geyserplot.png")	# Copy my plot to a PNG file
dev.off()	# Don't forget to close the PNG device!
```

#### Summary

 * Plots must be created on a graphics device
 * The default graphics device is almost always the screen device, which is most useful for exploratory analysis
 * File devices are useful for creating plots that can be included in other documents or sent to other people
 * For file devices, there are vector and bitmap formats
      + Vector formats are good for line drawings and plots with solid colors using a modest number of points
      + Bitmap formats are good for plot with a large number of points, natural scenes or web-based plot

